<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>神旨驾到·营会小组看板</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #0d0d1a; color: white; }
  .btn { background-color: #1e88e5; color: white; padding: 6px 12px; text-decoration: none; border-radius: 6px; margin: 3px; display: inline-block; }
  .btn:hover { background-color: #1565c0; }
  .btns { margin-top: 8px; }
</style>
</head>
<body>
<h1>神旨驾到·营会小组看板</h1>

<div id="content"></div>

<script>
function normalizeUrl(u){
  if (!u || typeof u !== 'string') return '';
  u = u.trim();
  u = u.replace(/[，。,.;；、)\]\}]+$/g, '');
  if (/^www\./i.test(u)) u = 'https://' + u;
  if (!/^https?:\/\//i.test(u)) return '';
  return u;
}

function extractUrls(str){
  if (typeof str !== 'string') return [];
  const out = [];
  const re = /(https?:\/\/[^\s'"<>\)\]\}，。；、]+)/ig;
  let m;
  while ((m = re.exec(str)) !== null) {
    const nu = normalizeUrl(m[0]);
    if (nu) out.push(nu);
  }
  if (out.length === 0) {
    const m2 = str.match(/(^|\s)(www\.[^\s'"]+)/i);
    if (m2) {
      const nu2 = normalizeUrl(m2[2]);
      if (nu2) out.push(nu2);
    }
  }
  return out;
}

function buttonsHTML(urls, label){
  if (!label) label = "打开链接";
  if (!urls.length) return "";
  return '<div class="btns">' + urls
    .map(u => `<a class="btn" href="${u}" target="_blank" rel="noopener noreferrer">${label}</a>`)
    .join("") + '</div>';
}

function renderOtherFields(obj){
  const blocks = [];
  for (const [k, v] of Object.entries(obj)) {
    if (typeof v === "string") {
      const urls = extractUrls(v);
      if (urls.length) {
        blocks.push(`<div><strong>${k}：</strong>${buttonsHTML(urls, '打开 ' + k)}</div>`);
      } else {
        blocks.push(`<div><strong>${k}：</strong>${v}</div>`);
      }
      continue;
    }
    if (Array.isArray(v)) {
      const urls = v.flatMap(x => typeof x === "string" ? extractUrls(x) : []);
      if (urls.length) {
        blocks.push(`<div><strong>${k}：</strong>${buttonsHTML(urls, '打开 ' + k)}</div>`);
        continue;
      }
      const text = v.map(x => typeof x === "string" ? x : (x && x.url ? x.url : JSON.stringify(x))).join("、");
      blocks.push(`<div><strong>${k}：</strong>${text}</div>`);
      continue;
    }
    blocks.push(`<div><strong>${k}：</strong>${JSON.stringify(v)}</div>`);
  }
  return blocks.join("");
}

// 示例数据
const example = {
  "夏令营敬拜歌曲": "https://music.youtube.com/playlist?list=PLHry6DiwpVwuXp2vUMLVmBdD5hwSVGPUm",
  "纪律": "2222",
  "备注": "请准时到场"
};

document.getElementById("content").innerHTML = renderOtherFields(example);
</script>
</body>
</html>
