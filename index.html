<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>神旨驾到 · 小组看板</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial; margin:0; background:#0f1222; color:#e8ecff; }
  .wrap { max-width: 860px; margin: 0 auto; padding: 18px; }
  .card { background: linear-gradient(180deg,#161a2e,#14182b); border:1px solid #272b45; border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35); margin-top:14px;}
  .title { font-size:22px; margin:0 0 4px 0;}
  .muted { color:#aab1d6; }
  .pill { display:inline-block; padding:6px 10px; border:1px solid #2a2f53; border-radius:999px; background:#1a1f3b; color:#b9c2ff; font-size:12px; margin-right:8px }
  a { color:#acd0ff }
  .btn { display:inline-block; padding:12px 14px; border-radius:12px; background:#253157; border:1px solid #2f3a66; text-decoration:none; color:#eaf1ff; font-weight:600; }
  .list { list-style:none; padding-left:0; }
  .list li { padding:8px 0; border-bottom:1px dashed #2a2f53; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 class="title">神旨驾到 · 小组看板</h1>
    <div id="gidLabel" class="muted"></div>
    <div style="margin-top:8px">
      <span class="pill">实时更新</span>
      <span class="pill">NFC 一碰即达</span>
    </div>
  </div>

  <div id="content" class="card">
    <div class="muted">正在载入数据…</div>
  </div>

  <div class="card">
    <div class="muted">提示：若信息未刷新，尝试下拉刷新或过几秒再试。</div>
  </div>
</div>

<script>
  // === 配置：把下面这个地址改成你的 Cloudflare Worker 地址 ===
  const API_BASE = "https://summercamp2025si.mumulinhuikai.workers.dev";

  const params = new URLSearchParams(location.search);
  const gid = params.get("gid") || "1";
  document.getElementById("gidLabel").textContent = "当前组别：gid=" + gid;

  async function load() {
    try {
      const r = await fetch(API_BASE + "/?gid=" + encodeURIComponent(gid));
      const j = await r.json();
      if (!r.ok) throw new Error(j.error || "加载失败");

      const wrap = document.getElementById("content");
      const members = (j.members || "").split(",").map(s=>s.trim()).filter(Boolean);
      wrap.innerHTML = `
        <h2 style="margin-top:0">${j.groupName || "未命名小组"}</h2>
        <p class="muted">带领：${j.leaders || "—"} · 积分：${j.points ?? 0}</p>
        ${j.announcement ? `<p>公告：${j.announcement}</p>` : ""}
        ${members.length ? `<h3>成员</h3><ul class="list">${members.map(m=>`<li>${m}</li>`).join("")}</ul>` : ""}
        ${j.resourcesLink ? `<p><a class="btn" href="${j.resourcesLink}" target="_blank" rel="noopener">资料与链接</a></p>` : ""}
        <p class="muted" style="font-size:12px">最后更新：${new Date(j.lastEditedTime).toLocaleString()}</p>
      `;
    } catch (e) {
      document.getElementById("content").innerHTML = `<p>载入失败：${e.message}</p>`;
    }
  }
  load();
</script>
</body>
</html>
